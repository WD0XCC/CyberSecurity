# 1、侦察阶段

首先有一个指定的目标：渗透测试的一个入口点， 例如一个网站、服务器等

## 1.1 主动扫描

### 1.1.1 描述

目的：通过主动扫描可以用于在网络中收集资产信息，便于快速掌握开放到公网上的网络服务。

主动扫描存在的问题：在不开启代理的情况下会暴漏个人IP。容易导致自己的IP被Ban或者溯源反恐等风险。除了设置代理外可以使用各大安全厂商网络空间扫描引擎。

服务器系统类型、网站类型、域名解析IP、

### 1.1.2 使用的工具

| 工具名称 | 简要描述                                                     | 官网地址                                     |
| -------- | ------------------------------------------------------------ | -------------------------------------------- |
| Namp     | 源代码的网络探测和安全审核的工具                             | https://namp.org                             |
| Masscan  | 号称是最快的互联网端口扫描器，最快可以在六分钟内扫遍互联网。 | https://github.com/robertdavidgraham/masscan |
| ZoomEye  | 支持公网设备指纹检索和 Web 指纹检索                          | https://www.zoomeye.org                      |
| Shodan   | 用来搜索网络空间中在线设备                                   | https://www.shodan.io/                       |
| FOFA     | 能够帮助研究人员或者企业迅速进行网络资产匹配                 | https://fofa.so/                             |

**1、Nmap**

**Nmap(“Netw**ork Mapper(网络映射器)”)是一款开放源代码的网络探测和安全审核的工具。它的设计目标是快速地扫描大型网络，当然用它扫描单个主机也没有问题。Nmap一新颖的方式使用原始IP报文来发现网络上有哪些主机，哪些主机提供什么服务(应用程序名和版本)，哪些服务运行在什么操作系统(包括版本信息)，它们使用什么类型的报文过滤器/防火墙，以及一堆其它功能。虽然Nmap通常用于安全审核，许多系统管理员和网络管理员也用它来做一些日常的工作，比如查看整个网络的信息，管理服务升级计划，以及监视主机和服务的运行。

**2、Masscan**

Masscan号称是最快的互联网端口扫描器，最快可以在六分钟内扫遍互联网。

**3、ZoomEye**

知道创宇的一个搜索引擎。ZoomEye 支持公网设备指纹检索和 Web 指纹检索。网站指纹包括应用名、版本、前端框架、后端框架、服务端语言、服务器操作系统、网站容器、内容管理系统和数据库等。设备指纹包括应用名、版本、开放端口、操作系统、服务名、地理位置等。

**4、Shodan**

Shodan 是用来搜索网络空间中在线设备的，你可以通过 Shodan 搜索指定的设备，或者搜索特定类型的设备，其中 Shodan 上最受欢迎的搜索内容是：webcam，linksys，cisco，netgear，SCADA等等。

**5、FOFA**

FOFA是白帽汇推出的一款网络空间搜索引擎，它通过进行网络空间测绘，能够帮助研究人员或者企业迅速进行网络资产匹配，例如进行漏洞影响范围分析、应用分布统计、应用流行度排名统计等。

## 1.2 漏洞扫描

### 1.2.1 描述

渗透测试收集信息完成后，就要根据所收集的信息，扫描目标站点可能存在的漏洞了，包括我们之前提到过的如：SQL注入漏洞、跨站脚本漏洞、文件上传漏洞、文件包含漏洞及命令执行漏洞等，通过这些已知的漏洞，来寻找目标站点的突破口。

### 1.2.2 漏扫工具

攻击者可能会进一步扫描受害者以查找可以使用的漏洞。漏洞扫描通常检查目标主机/应用程序的配置是否存在攻击者可以利用的攻击点。

| 工具名称 | 简要描述                                                     | 官网地址                              |
| -------- | ------------------------------------------------------------ | ------------------------------------- |
| AWVS     | 网络漏洞扫描工具，它通过网络爬虫测试你的网站安全，检测流行安全漏洞 | https://www.acunetix.com              |
| Nessus   | 系统漏洞扫描与分析软件                                       | https://zh-cn.tenable.com             |
| w3af     | 一个Web应用程序攻击和检查框架                                | http://w3af.org/                      |
| ZAP      | 免费安全审计工具之一                                         |                                       |
| 御剑     | 御剑后台扫描珍藏版是T00LS大牛的作品,方便查找用户后台登陆地址，附带很强大的字典。 | http://github.com/foryujian/yjdirscan |
| Appscan  |                                                              |                                       |
| xray     |                                                              |                                       |



**1、AWVS**

Acunetix Web Vulnerability Scanner（简称AWVS）是一款知名的网络漏洞扫描工具，它通过网络爬虫测试你的网站安全，检测流行安全漏洞，它的官方网站是：[https://www.acunetix.com](https://link.zhihu.com/?target=https%3A//www.acunetix.com/)，我刚才看了一眼没有找到试用版下载链接，之前是有的，可以免费试用14天，当然你也可以去网上搜索破解版进行下载安装，有经济实力的朋友可以考虑购买正版软件，下图就是AWVS的主界面，里边还保存着我扫描过的两个站点，发现了4个高危漏洞，4个中危漏洞和20个低危漏洞。

**2、Nessus**

Nessus 是目前全世界最多人使用的系统漏洞扫描与分析软件。总共有超过75,000个机构使用Nessus 作为扫描该机构电脑系统的软件。

3、**w3af**

w3af是一个Web应用程序攻击和检查框架，该项目已超过130个插件，其中包括检查网站爬虫、SQL注入(SQL Injection)、跨站(XSS)、本地文件包含(LFI)、远程文件包含(RFI)等，该项目的目标是要建立一个框架，以寻找和开发Web应用安全漏洞，所以很容易使用和扩展，w3af常用的是在Linux系统下。

**4、ZAP**

OWASP Zed攻击代理（ZAP）是世界上最受欢迎的免费安全审计工具之一，由数百名国际志愿者积极维护，它可以帮助您在开发和测试应用程序时自动查找Web应用程序中的安全漏洞，它的主要功能有：本地代理、主动扫描、被动扫描、Fuzzy和暴力破解等，以下就是ZAP的主界面，在攻击地址栏里输入目标站点域名或IP点击攻击就可以了。

**5、御剑**

御剑后台扫描珍藏版是T00LS大牛的作品,方便查找用户后台登陆地址，附带很强大的字典，字典也是可以自己修改的，使用方法也非常简单，只需要在“域名框”输入你要扫描的域名即可，用户可根据自身电脑的配置来设置调节扫描线程，集合DIR扫描、ASP、ASPX、PHP、JSP、MDB数据库，包含所有网站脚本路径扫描，默认探测200 (也就是扫描的网站真实存在的路径文件)，我在之前信息收集工具介绍中也提到过御剑，其实是想介绍御剑指纹识别系统的，现在已经更改，在域名栏输入目标站点域名点击扫描就可以了，如果前期信息收集全面，可以选择站点后台语言。

**6、Appscan**

**7、xray**



漏扫工具存在的最大问题是流量特征容易被检测到。

# 2、信息收集

## 2.1、收集受害者身份信息

在入侵受害者之前，攻击者可以通过各种方式收集信息。攻击者还可能入侵站点，然后植入旨在收集访问者网站认证cookie的恶意内容。凭证信息也可能通过在线或其他可访问的数据集（例如：搜索引擎，泄露凭据转储，代码仓库等）暴露给攻击者。攻击者还可以从暗网或其他黑市购买凭证。收集这些信息可能为其他形式的侦察提供可能性（例如：搜索开放网站/域或钓鱼），建立运营资源（例如：入侵账号），或实现初始访问（例如：外部远程服务或有效账号）。

### 2.1.1 身份信息类型

手机号、员工姓名、电子邮件地址  凭据/账号密码  

社交媒体账号：微信、QQ、微博、博客、

身份证号信息、护照信息、户籍信息



### 2.1.2 信息收集工具



2）

社工库、

在tg-sgk机器人处直接输入受害者的邮箱、微博地址、手机号码、QQ等进行查寻受害者的密码信息。

maltego是一款信息收集工具，它可以通过IP，域名等方式搜集查询到网站注册人邮箱等其他相关信息。

## 2.2、受害者主机信息

attack矩阵给出了四个子技术，分别是硬件，软件，固件和客户端信息，并给出提示通过扫描探测，网络钓鱼或者社工（比如寻找一些该公司泄露出的购物发票等信息）的方式去获取这四种信息。

### 2.2.1 硬件信息

这些信息包含各种详细信息，例如特定主机上的类型和版本，以及其他可能存在的防御保护组件。

### 2.2.2 软件信息

这些信息包含各种详细信息，例如特定主机上的类型和版本，以及其他可能存在的防御保护组件（例如，杀毒软件，SIEM等）。

### 2.2.4 固件信息

这些信息包含各种详细信息，例如特定主机上的类型和版本，这些信息可用于推断有关环境中主机的更多信息（例如：配置，用途，使用期限/补丁程序级别等）。

### 2.2.5 客户端信息

这些信息包含各种详细信息，包括操作系统/版本，虚拟化，体系结构（例如32位或64位），语言和/或时区。

1）Subfinder

Subfinder是一个发现子域的工具，可以发现网站的有效子域。

2）assetfinder

查找与给定域名相关的域名和子域名。

3）knockknock

一个简单的反向whois查询工具，可以返回一个由人或公司拥有的域名列表。

4）findomain

域名识别的完整解决方案。支持截屏、端口扫描、HTTP检查、从其他工具导入数据、子域监控、通过Discord、Slack和Telegram发出警报、多个来源的API密钥等等。

5）hakrevdns

小型、快速的工具，用于大量执行反向DNS查询。

6）Amass

深入的攻击面测绘和资产发现。

7）谷歌证书透明度

该工具允许用户从SSL证书中收集域名和子域名。

## 2.3、收集受害者网络信息

收集有关受害者网络的信息。有关网络的信息可能包括各种详细信息，包括IP，域名以及有关其拓扑和操作的详细信息。

### 2.3.1 域属性

#### 1）描述

收集有关受害者网络域的信息。有关域及其属性的信息可能包括各种详细信息，包括受害者拥有的域以及姓名，注册商或者更直接可操作的信息，例如联系人，公司地址和名称服务器的相关信息。

#### 2）工具

| 名称     | 描述                                                       | 地址                      |
| -------- | ---------------------------------------------------------- | ------------------------- |
| 站长之家 | 用来查询域名是否已经被注册，以及注册域名的详细信息的数据库 | https://whois.chinaz.com/ |
|          |                                                            |                           |
|          |                                                            |                           |
|          |                                                            |                           |
|          |                                                            |                           |

**1、Whois查询**

Whois 简单来说，就是一个用来查询域名是否已经被注册，以及注册域名的详细信息的数据库（如域名所有人、域名注册商、域名注册日期和过期日期等）。通过域名Whois服务器查询，可以查询域名归属者联系方式，以及注册和到期时间

2、备案号查询

3、工商信息查询

### 2.3.2 域名解析

#### 1）描述

收集有关受害者DNS的信息。DNS信息可能包括各种详细信息，包括注册服务器以及目标子域，邮件服务器和其他主机的地址的记录。

#### 2）工具

https://github.com/dnsdb/dnsdbq

https://dnsdumpster.com/是个在线查询DNS的网站，它能显示出域名服务商所在地，MX记录，TXT记录及A记录，也能绘制出映射域的图像

### 2.3.3 网络可信依赖

有关网络信任的信息可能包括各种详细信息，包括已连接（并可能提升了）网络访问权限的第二或第三方组织/域

### 2.3.4 网络拓扑

关于网络拓扑的信息可以包括各种细节，包括面向外部和内部网络环境的物理、逻辑布局。此信息可能还包括有关网络设备（网关，路由器等）和其他基础结构的详细信息。

网络拓扑的获取是存在一些难度的，但是通过有效的社工，还是有可能获得目标的网络拓扑。

提到网络拓扑，如果您已经进入到某一个内部网络，想要获取取得权限或者相关网络拓扑时，那么您一定会回忆起一款工具——BloodHound，它不仅能让您看到相关网络关系，还可以选择最佳攻击路线和最简获得域控的步骤。

### 2.3.5 IP地址

收集受害者的IP地址。公用IP地址可以按一定顺序分配给组织。有关分配的IP地址信息可能包括各种详细信息，例如正在使用的IP地址。IP地址还可以使攻击者获得有关受害者的其他详细信息，例如组织规模，地理位置，Internet服务提供商，以及在何处。

### 2.3.6 网络安全设备

收集有关目标受害者网络安全设备的信息。有关网络安全设备的信息可能包括各种详细信息，例如已部署的防火墙，IPS，IDS，EDR，堡垒机等的存在和详细信息。攻击者还可能针对有关基于受害者的网络入侵检测系统（NIDS）或其他与防御性网络安全操作有关的设备的信息。

## 3、收集受害者组织信息

### 3.1 描述

攻击者可能会收集与目标组织的业务有关的信息，这些信息可以在**定位**过程中使用。有关组织业务信息可能包括各种详细信息，包括每周的工作时间/天。此信息还可能显示受害者的硬件和软件资源的购买和运输时间/日期。

攻击者可以通过多种方式收集此信息，例如通过“网络钓鱼诱骗”直接诱捕。有关业务节奏的信息也可能会通过在线或其他可访问的数据集（例如，社交媒体或受害人拥有的网站）暴露给攻击者。

公司主站中会有业务方向、合作单位。企业关系挖掘、工商信息、商标专利、企业年报等信息查询，可以提供企业的较为细致的信息。

### 3.2 工具

工商信息

备案号查询

公司信息

## 4、参考资料

[ATT&CK 初探--侦察阶段 (seebug.org)](https://paper.seebug.org/1583/)

[T1589-001-收集受害者身份信息-凭证 - RedBook (y1ng.org)](https://red.y1ng.org/0x1_侦察/T1589-001-收集受害者身份信息-凭证/)